<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>PyChatX — Minimal Echo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { font-family: sans-serif; max-width: 720px; margin: 24px auto; }
    #log { border: 1px solid #ddd; padding: 12px; height: 280px; overflow-y: auto; }
    #status { margin-bottom: 12px; }
    input, button { padding: 8px; }
  </style>
</head>
<body>
  <h1>PyChatX — Minimal Echo</h1>
  <div id="status">Status: <strong>connecting…</strong></div>
  <div id="log"></div>
  <div style="margin-top:12px;">
    <input id="msg" placeholder="Type a message" size="40"/>
    <button id="send">Send</button>
    <button id="disconnect">Disconnect</button>
  </div>

  <script>
    const logEl = document.getElementById('log');
    const statusEl = document.getElementById('status').querySelector('strong');
    const msgEl = document.getElementById('msg');
    const sendBtn = document.getElementById('send');
    const disBtn  = document.getElementById('disconnect');

    function addLine(text) {
      const p = document.createElement('div');
      p.textContent = text;
      logEl.appendChild(p);
      logEl.scrollTop = logEl.scrollHeight;
    }

    let ws;

    function connect() {
      ws = new WebSocket(`ws://${location.host}/ws`);
      ws.onopen = () => {
        statusEl.textContent = 'connected';
        addLine('🟢 connected');
      };
      ws.onmessage = (e) => {
        addLine('server: ' + e.data);
      };
      ws.onclose = () => {
        statusEl.textContent = 'disconnected';
        addLine('🔴 disconnected');
      };
      ws.onerror = () => {
        statusEl.textContent = 'error';
        addLine('⚠️ error');
      };
    }

    sendBtn.onclick = () => {
      if (!ws || ws.readyState !== WebSocket.OPEN) {
        addLine('⚠️ not connected');
        return;
      }
      const text = msgEl.value.trim();
      if (!text) return;
      ws.send(text);
      addLine('you: ' + text);
      msgEl.value = '';
    };

    disBtn.onclick = () => ws && ws.close();

    // Try to connect when the page loads
    connect();

    // Check health (just to show it exists)
    fetch('/api/v1/health').then(r=>r.json()).then(j=>{
      addLine('health: ' + JSON.stringify(j));
    });
  </script>
</body>
</html>
